<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TrendAI Roleplay - Dark Theme</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Rajdhani', sans-serif;
      background-color: #0a0a0a;
      color: #eeeeee;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      background-color: #111;
      border-bottom: 1px solid #ff004033;
      z-index: 2;
    }

    .character-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .character-info img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 2px solid #ff0040;
    }

    .character-meta {
      display: flex;
      flex-direction: column;
    }

    .character-meta span:first-child {
      font-weight: bold;
      color: #ff0040;
    }

    .character-meta span:last-child {
      font-size: 0.75em;
      color: #999;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-actions button {
      background: none;
      border: none;
      color: #ff0040;
      font-size: 1.3em;
      cursor: pointer;
    }

    #chat-box {
      flex: 1 1 auto;
      overflow-y: auto;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 24px 0 24px 0;
      min-height: 0;
    }

    #chat-container {
      width: 100%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      padding: 0 18px;
      flex: 1 1 auto;
    }

    .message {
      padding: 16px 22px;
      border-radius: 14px;
      line-height: 1.6;
      position: relative;
      display: inline-block;
      max-width: 85%;
      font-size: 1.08em;
      margin-bottom: 2px;
      margin-top: 2px;
      box-shadow: 0 1px 6px #0a0a0a44;
      word-break: break-word;
    }

    .user {
      align-self: flex-end;
      background: linear-gradient(135deg, #ff0040, #660022);
      color: #f0f0f0;
    }

    .bot {
      align-self: flex-start;
      background: #1a1a1a;
      border-left: 4px solid #ff0040;
    }

    .reactions {
      font-size: 1.05em;
      color: #888;
      margin-top: 8px;
      display: flex;
      gap: 16px;
      padding-left: 2px;
    }

    .reactions span {
      cursor: pointer;
      transition: color 0.18s, transform 0.15s;
      border-radius: 4px;
      padding: 2px 5px;
      outline: none;
    }
    .reactions span:focus,
    .reactions span:hover {
      color: #ff0040;
      background: #ff004022;
      transform: scale(1.18);
    }

    #chat-form {
      display: flex;
      justify-content: center;
      padding: 10px 20px;
      background-color: #111;
    }

    .input-wrapper {
      position: relative;
      width: 100%;
      max-width: 600px;
    }

    #user-input {
      width: 100%;
      padding: 12px 44px 12px 14px;
      border-radius: 20px;
      background: #2a2a2a;
      border: none;
      color: #ff0040;
      font-size: 1em;
    }

    #user-input:focus {
      outline: none;
      box-shadow: 0 0 10px #ff004088;
    }

    #send-btn {
      position: absolute;
      top: 50%;
      right: 6px;
      transform: translateY(-50%);
      background: #ff0040;
      color: #121212;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      border: none;
      cursor: pointer;
      font-size: 1em;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #disclaimer {
      text-align: center;
      font-size: 0.75em;
      color: #999;
      padding: 10px;
      background-color: #0a0a0a;
    }

    #sidebar {
      position: fixed;
      top: 64px;
      /* header height: 64px (approx 50px + 2*12px) */
      right: -320px;
      width: 300px;
      height: calc(100% - 64px - 36px); /* minus header and footer/disclaimer */
      background-color: #111;
      border-left: 1px solid #ff004033;
      padding: 20px 18px 18px 18px;
      transition: right 0.3s cubic-bezier(.7,.2,.3,1);
      z-index: 100;
      box-shadow: -2px 0 12px #0a0a0a33;
      overflow-y: auto;
    }

    #sidebar.open {
      right: 0;
    }

    .sidebar-top {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .sidebar-top img {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      border: 2px solid #ff0040;
    }

    .meta {
      display: flex;
      flex-direction: column;
    }

    .meta .name {
      font-size: 1.1em;
      font-weight: bold;
      color: #ff0040;
    }

    .meta .username {
      font-size: 0.9em;
      color: #aaa;
    }

    .sidebar-actions {
      margin: 16px 0;
      display: flex;
      gap: 12px 16px;
      flex-wrap: wrap;
    }

    .sidebar-actions button {
      background: none;
      border: none;
      color: #ff0040;
      font-size: 1.2em;
      cursor: pointer;
    }

    .description {
      font-size: 0.9em;
      color: #ccc;
      margin-top: 10px;
    }

    .divider {
      border-top: 1px solid #ff004033;
      margin: 16px 0;
    }

    .sidebar-links button {
      width: 100%;
      margin: 8px 0;
      padding: 12px 10px;
      border-radius: 8px;
      background: #222;
      color: #ff0040;
      border: none;
      cursor: pointer;
      text-align: left;
      font-size: 1.05em;
      transition: background 0.18s, color 0.16s, box-shadow 0.15s;
      box-shadow: 0 1px 4px #0a0a0a22;
    }

    .sidebar-links button:hover,
    .sidebar-links button:focus {
      background-color: #ff004022;
      color: #fff;
      outline: none;
      box-shadow: 0 2px 8px #ff004022;
    }

    /* Theme Popup */
    #theme-overlay {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 10;
      display: none;
    }

    #theme-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background-color: #1a1a1a;
      color: #ff0040;
      padding: 24px 18px 18px 18px;
      border-radius: 16px;
      box-shadow: 0 0 18px 4px rgba(255, 0, 64, 0.22), 0 2px 16px 2px #000c;
      z-index: 101;
      display: none;
      transition: transform 0.26s cubic-bezier(.7,.2,.3,1), opacity 0.26s cubic-bezier(.7,.2,.3,1);
      opacity: 0;
      width: 320px;
      max-width: 94vw;
    }

    #theme-popup.active {
      display: block;
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      pointer-events: auto;
    }
    /* Toast Styles */
    #toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: #1a1a1aee;
      color: #ff0040;
      border-radius: 10px;
      padding: 13px 26px;
      font-size: 1.05em;
      box-shadow: 0 3px 18px #ff004055, 0 1px 8px #000a;
      opacity: 0;
      transition: opacity 0.25s cubic-bezier(.7,.2,.3,1), bottom 0.25s;
      z-index: 120;
      pointer-events: none;
      text-align: center;
    }
    #toast.visible {
      opacity: 1;
      bottom: 60px;
      pointer-events: auto;
    }

    #theme-popup h2 {
      text-align: center;
      margin-bottom: 16px;
      font-size: 1.2em;
      color: #ffffff;
    }

    .theme-options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .theme-btn {
      flex: 1 1 calc(50% - 10px);
      padding: 10px;
      border: none;
      background: #2a2a2a;
      color: #ff0040;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .theme-btn:hover {
      background: #ff004022;
    }
  </style>
</head>
<body>
  <header>
    <div class="character-info">
      <img id="char-img" src="" alt="Character" />
      <div class="character-meta">
        <span id="char-name">Character</span>
        <span id="creator">by Creator</span>
      </div>
    </div>
    <div class="header-actions">
      <button id="sound-toggle">üîä</button>
      <button id="sidebar-toggle">‚ò∞</button>
    </div>
  </header>

  <div id="sidebar">
    <div class="sidebar-top">
      <img id="sidebar-img" src="https://via.placeholder.com/100" alt="Character" />
      <div class="meta">
        <div class="name" id="sidebar-char-name">Character</div>
        <div class="username" id="sidebar-username">@username</div>
      </div>
    </div>
    <div class="sidebar-actions">
      <button id="export-btn" title="Export">üì§</button>
      <button id="like-btn" title="Like">üëç</button>
      <button id="dislike-btn" title="Dislike">üëé</button>
      <span style="width: 12px;"></span>
      <button id="report-btn" title="Report">‚ö†Ô∏è</button>
    </div>
    <div class="description" id="sidebar-description">This character is shrouded in darkness, ready to lead you into a thrilling tale.</div>
    <div class="divider"></div>
    <div class="sidebar-links">
      <button id="new-chat-btn"><i class="fas fa-comments"></i> New Chat</button>
      <button id="voice-btn">üé§ Voice</button>
      <button id="history-btn">üïì History</button>
      <button id="customize-btn">üõ†Ô∏è Customize</button>
      <button id="theme-trigger">üé® Themes</button>
    </div>
  </div>
  <div id="toast"></div>

  <div id="chat-box">
    <div id="chat-container"></div>
  </div>

  <form id="chat-form">
    <div class="input-wrapper">
      <input type="text" id="user-input" placeholder="Speak into the shadows..." autocomplete="off" required />
      <button type="submit" id="send-btn">üì§</button>
    </div>
  </form>

  <div id="disclaimer">This is a fictional AI character for roleplay. Be ready for dark, thrilling tales...</div>

  <!-- üé® Theme Popup -->
  <div id="theme-overlay"></div>
  <div id="theme-popup">
    <h2>Choose a Theme</h2>
    <div class="theme-options">
      <button class="theme-btn" onclick="window.location.href='roleplay1.html'">üåë Dark</button>
      <button class="theme-btn" onclick="window.location.href='roleplay2.html'">üíñ Romantic</button>
      <button class="theme-btn" onclick="window.location.href='roleplay3.html'">üò¢ Emotional</button>
      <button class="theme-btn" onclick="window.location.href='roleplay4.html'">üéâ Fun</button>
      <button class="theme-btn" onclick="window.location.href='roleplay6.html'">üå∏ Soft Pastel</button>
      <button class="theme-btn" onclick="window.location.href='roleplay.html'">üöÄ Futuristic</button>
      <button class="theme-btn" onclick="window.location.href='roleplay7.html'">üßô Fantasy</button>
      <button class="theme-btn" onclick="window.location.href='roleplay8.html'">üéÆ Retro</button>
    </div>
  </div>

  <script>
    // --- Character and Profile Setup ---
    const characterKey = localStorage.getItem("roleplayCharacter");
    const characters = JSON.parse(localStorage.getItem("characters")) || [];
    const profile = JSON.parse(localStorage.getItem("userProfile")) || { username: "unknown" };
    const charData = characters.find(c => c.name === characterKey);
    const name = profile.displayName || "You";
    const charName = charData?.name || "AI";
    const charImg = charData?.image || "https://via.placeholder.com/100";
    const creator = profile.username || "unknown";
    document.getElementById("char-name").textContent = charName;
    document.getElementById("char-img").src = charImg;
    document.getElementById("creator").textContent = `by ${creator}`;
    document.getElementById("sidebar-char-name").textContent = charName;
    document.getElementById("sidebar-img").src = charImg;
    document.getElementById("sidebar-username").textContent = `@${creator}`;
    document.getElementById("sidebar-description").textContent = charData?.description || "No description provided.";

    // --- DOM References ---
    const chatContainer = document.getElementById("chat-container");
    const form = document.getElementById("chat-form");
    const input = document.getElementById("user-input");
    let isMuted = false;
    let lastReactionBox = null;
    let currentChatId;

    // --- Toast Notification ---
    function showToast(msg, timeout = 2000) {
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.classList.add("visible");
      setTimeout(() => toast.classList.remove("visible"), timeout);
    }

    // --- Chat Session Management ---
    function getAllChats() {
      return JSON.parse(localStorage.getItem("chatSessions")) || {};
    }
    function saveAllChats(allChats) {
      localStorage.setItem("chatSessions", JSON.stringify(allChats));
    }
    function getCharacterChatMap() {
      return JSON.parse(localStorage.getItem("characterChatMap")) || {};
    }
    function saveCharacterChatMap(map) {
      localStorage.setItem("characterChatMap", JSON.stringify(map));
    }

    // --- Recent Character Tracking ---
    function updateRecentCharacters() {
      if (characterKey) {
        let recent = JSON.parse(localStorage.getItem("recentCharacters")) || [];
        const existingIndex = recent.indexOf(characterKey);
        if (existingIndex !== -1) recent.splice(existingIndex, 1);
        recent.push(characterKey);
        localStorage.setItem("recentCharacters", JSON.stringify(recent));
      }
    }
    updateRecentCharacters();

    // --- Chat Session Initialization ---
    function initChatSession() {
      let characterChatMap = getCharacterChatMap();
      currentChatId = characterChatMap[characterKey];
      if (!currentChatId) {
        currentChatId = Date.now().toString();
        characterChatMap[characterKey] = currentChatId;
        saveCharacterChatMap(characterChatMap);
      }
      let allChats = getAllChats();
      let chat = allChats[currentChatId];
      if (!chat) {
        chat = {
          id: currentChatId,
          character: characterKey,
          name: charName,
          creator: creator,
          image: charImg,
          messages: [],
          lastUpdated: new Date().toISOString(),
        };
        allChats[currentChatId] = chat;
        saveAllChats(allChats);
      }
      return chat;
    }

    // --- Chat Message Creation (with typing animation and reactions) ---
    function createMessage(text, sender, skipSave = false) {
      const isBot = sender === "bot";
      const msg = document.createElement("div");
      msg.className = `message ${sender}`;
      chatContainer.appendChild(msg);
      let index = 0;
      const typingSpeed = isBot ? 20 : 0;
      function typeChar() {
        if (index < text.length) {
          msg.textContent += text.charAt(index);
          index++;
          setTimeout(typeChar, typingSpeed);
        }
      }
      if (typingSpeed) typeChar(); else { msg.textContent = text; }
      if (!skipSave) saveMessageToChat(text, sender);
      if (lastReactionBox) lastReactionBox.remove();
      if (isBot) {
        const box = document.createElement("div");
        box.className = "reactions";
        box.innerHTML = '<span title="Like">üëç</span><span title="Dislike">üëé</span><span title="Play Audio">üîä</span>';
        msg.appendChild(box);
        lastReactionBox = msg;
      }
      setTimeout(() => {
        const chatBox = document.getElementById("chat-box");
        chatBox.scrollTop = chatBox.scrollHeight - 100;
      }, 100);
    }

    function saveMessageToChat(text, sender) {
      let allChats = getAllChats();
      let chat = allChats[currentChatId];
      if (!chat) return;
      chat.messages.push({ text, sender, timestamp: Date.now() });
      chat.lastUpdated = new Date().toISOString();
      allChats[currentChatId] = chat;
      saveAllChats(allChats);
    }

    // --- Load Chat History for Current Session ---
    function loadChatHistory() {
      chatContainer.innerHTML = "";
      lastReactionBox = null;
      let allChats = getAllChats();
      let chat = allChats[currentChatId];
      if (chat && chat.messages.length > 0) {
        chat.messages.forEach(m => createMessage(m.text, m.sender, true));
      } else {
        createMessage(`Hey ${name}, welcome to the shadows...`, "bot");
      }
    }

    // --- Form Submission ---
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const userText = input.value.trim();
      if (!userText) return;
      createMessage(userText, "user");
      input.value = "";
      setTimeout(() => {
        createMessage(`That‚Äôs intriguing... Tell me more about "${userText}"`, "bot");
      }, 600);
    });

    // --- Sound Toggle ---
    document.getElementById("sound-toggle").addEventListener("click", () => {
      isMuted = !isMuted;
      document.getElementById("sound-toggle").textContent = isMuted ? "üîá" : "üîä";
      showToast(isMuted ? "Sound muted." : "Sound on.");
    });

    // --- Sidebar Toggle ---
    const sidebar = document.getElementById("sidebar");
    const toggleBtn = document.getElementById("sidebar-toggle");
    toggleBtn.addEventListener("click", (e) => {
      sidebar.classList.toggle("open");
      e.stopPropagation();
    });
    document.addEventListener("mousedown", (e) => {
      if (!sidebar.contains(e.target) && !toggleBtn.contains(e.target)) {
        sidebar.classList.remove("open");
      }
    });
    function adjustSidebar() {
      const header = document.querySelector("header");
      const disclaimer = document.getElementById("disclaimer");
      const headH = header.offsetHeight;
      const discH = disclaimer.offsetHeight;
      sidebar.style.top = headH + "px";
      sidebar.style.height = `calc(100% - ${headH + discH}px)`;
    }
    window.addEventListener("resize", adjustSidebar);
    window.addEventListener("DOMContentLoaded", adjustSidebar);
    adjustSidebar();

    // --- Theme Popup Modal ---
    const themeBtn = document.getElementById("theme-trigger");
    const themePopup = document.getElementById("theme-popup");
    const themeOverlay = document.getElementById("theme-overlay");
    themeBtn.addEventListener("click", () => {
      themePopup.classList.add("active");
      themeOverlay.style.display = "block";
      setTimeout(() => { themePopup.focus(); }, 10);
    });
    themeOverlay.onclick = () => {
      themePopup.classList.remove("active");
      themeOverlay.style.display = "none";
    };
    document.addEventListener("keydown", (e) => {
      if ((themePopup.classList.contains("active") || themeOverlay.style.display === "block") && e.key === "Escape") {
        themePopup.classList.remove("active");
        themeOverlay.style.display = "none";
      }
    });

    // --- Sidebar Links Functionality ---
    document.getElementById("new-chat-btn").addEventListener("click", () => {
      const newId = Date.now().toString();
      let characterChatMap = getCharacterChatMap();
      characterChatMap[characterKey] = newId;
      saveCharacterChatMap(characterChatMap);
      let allChats = getAllChats();
      allChats[newId] = {
        id: newId,
        character: characterKey,
        name: charName,
        creator: creator,
        image: charImg,
        messages: [],
        lastUpdated: new Date().toISOString(),
      };
      saveAllChats(allChats);
      currentChatId = newId;
      loadChatHistory();
      showToast("Started a new chat.");
      sidebar.classList.remove("open");
    });
    document.getElementById("history-btn").addEventListener("click", () => {
      renderChatHistory();
      showToast("History opened.");
      sidebar.classList.remove("open");
    });
    document.getElementById("voice-btn").addEventListener("click", () => {
      showToast("Voice mode coming soon.");
      sidebar.classList.remove("open");
    });
    document.getElementById("customize-btn").addEventListener("click", () => {
      if (characterKey) {
        window.location.href = `create-character.html?from=roleplay1.html&name=${encodeURIComponent(characterKey)}`;
      } else {
        showToast("No character selected to customize.");
      }
    });

    // --- Export Chat Functionality ---
    document.getElementById("export-btn").addEventListener("click", () => {
      let allChats = getAllChats();
      let chat = allChats[currentChatId];
      if (!chat) {
        showToast("No current chat available to export.");
        return;
      }
      const chatText = chat.messages.map(m => `${m.sender === "user" ? name : charName}: ${m.text}`).join("\n");
      const blob = new Blob([chatText], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `${charName}_chat.txt`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      showToast("Chat exported!");
      sidebar.classList.remove("open");
    });

    // --- Report Functionality (Simple Modal) ---
    let reportModal = null;
    let reportOverlay = null;
    function closeReportModal() {
      if (reportModal) reportModal.remove();
      if (reportOverlay) reportOverlay.remove();
      reportModal = null;
      reportOverlay = null;
    }
    document.getElementById("report-btn").addEventListener("click", () => {
      closeReportModal();
      reportOverlay = document.createElement("div");
      reportOverlay.style.cssText = "position:fixed;inset:0;background:#000a;z-index:150;";
      reportModal = document.createElement("div");
      reportModal.style.cssText = "position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(1);background:#181818;color:#ff0040;padding:22px 18px 18px 18px;border-radius:14px;box-shadow:0 0 20px #ff004055,0 2px 16px #000a;z-index:151;min-width:260px;max-width:96vw;";
      reportModal.innerHTML = `
        <h2 style="margin:0 0 12px 0;color:#fff;text-align:center;font-size:1.13em;">Report Character</h2>
        <textarea id="report-reason" rows="3" style="width:100%;border-radius:8px;background:#222;color:#ff0040;border:none;padding:8px;margin-bottom:12px;font-family:inherit;font-size:1em;" placeholder="Describe the issue..."></textarea>
        <br>
        <button id="report-submit" style="background:#ff0040;color:#fff;border:none;padding:8px 20px;border-radius:8px;font-size:1em;cursor:pointer;box-shadow:0 1px 6px #0a0a0a33;">Submit</button>
        <button id="report-cancel" style="margin-left:14px;background:#222;color:#ff0040;border:none;padding:8px 20px;border-radius:8px;font-size:1em;cursor:pointer;">Cancel</button>
      `;
      document.body.appendChild(reportOverlay);
      document.body.appendChild(reportModal);
      document.getElementById("report-reason").focus();
      document.getElementById("report-cancel").onclick = closeReportModal;
      reportOverlay.onclick = closeReportModal;
      document.getElementById("report-submit").onclick = function() {
        let reason = document.getElementById("report-reason").value.trim();
        if (!reason) {
          showToast("Please enter a reason.");
          return;
        }
        closeReportModal();
        showToast("Report submitted. Thank you!");
        sidebar.classList.remove("open");
        // Here you would send the report to server/Firestore etc.
      };
    });

    // --- Like / Dislike Buttons in Sidebar ---
    document.getElementById("like-btn").addEventListener("click", () => showToast("You liked this character!"));
    document.getElementById("dislike-btn").addEventListener("click", () => showToast("You disliked this character!"));

    // --- Message Reactions (Only on latest bot message) ---
    chatContainer.addEventListener("click", (e) => {
      if (!e.target.closest('.reactions span')) return;
      // Only allow reactions on the last bot message
      const msg = e.target.closest('.message.bot');
      if (!msg || msg !== lastReactionBox) {
        showToast("You can only react to the latest bot reply.");
        return;
      }
      const type = e.target.textContent.trim();
      if (type === "üëç") showToast("You liked the reply!");
      else if (type === "üëé") showToast("You disliked the reply.");
      else if (type === "üîä") {
        if (isMuted) {
          showToast("Sound is muted.");
        } else {
          if ('speechSynthesis' in window) {
            const utter = new SpeechSynthesisUtterance(msg.textContent.replace(/üëç|üëé|üîä/g, ""));
            utter.rate = 1;
            utter.pitch = 1;
            utter.lang = "en-US";
            window.speechSynthesis.speak(utter);
            showToast("Playing voice...");
          } else {
            showToast("TTS not supported.");
          }
        }
      }
    });

    // --- Send Button Click (for accessibility) ---
    document.getElementById("send-btn").addEventListener("click", function(e) {
      e.preventDefault();
      form.requestSubmit();
    });

    // --- Chat History Modal/Sidebar ---
    function renderChatHistory() {
      let allChats = getAllChats();
      const chatsForChar = Object.values(allChats).filter(chat => chat.character === characterKey);
      if (!chatsForChar.length) {
        showToast("No chat history available for this character.");
        return;
      }
      // Simple modal for now (can be improved to sidebar/modal as in roleplay.html)
      let historyList = chatsForChar
        .sort((a, b) => new Date(b.lastUpdated) - new Date(a.lastUpdated))
        .map(chat => `üïì ${new Date(chat.lastUpdated).toLocaleString()} ‚Äî ${chat.messages.length} msgs`)
        .join("\n\n");
      alert(`History:\n\n${historyList}`);
    }

    // --- On Load: Initialize Session and Load Chat ---
    (function() {
      initChatSession();
      loadChatHistory();
    })();
  </script>
</body>
</html>